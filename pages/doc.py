import streamlit as st
from uuid import uuid4
import chromadb
from openai.embeddings_utils import get_embedding
from llama_index.llms.openai import OpenAI

# Skapa en ChromaDB-klient
client = chromadb.Client()
collection = client.create_collection("documents")

# Lägg till en funktion för att indexera text
def index_texts(texts, collection):
    for text in texts:
        embedding = get_embedding(text, model="text-embedding-003")
        collection.add(
            documents=[text],
            embeddings=[embedding],
            metadatas=[{"source": "manual"}],
            ids=[str(uuid4())]
        )

# Indexera din text här
texts_to_index = [
    "Digitalisering är en central del i Karlskoga kommuns strategi för att möta framtidens krav och säkerställa en effektiv och hållbar verksamhet. Genom att stärka den digitala mognaden och utveckla moderna lösningar kan kommunen förbättra både service och resursutnyttjande, samtidigt som varje skattekrona används på bästa sätt. Denna rapport utvärderar nuläget för kommunens arbete med digitalisering utifrån internkontrollens genomlysning. Resultaten visar att betydande framsteg har gjorts, särskilt inom områden som tekniska lösningar, kompetensutveckling och samordning. Samtidigt identifieras flera utmaningar, bland annat variationer i digital kompetens, ojämn implementering av digitaliseringsstrategin och bristande uppföljning av effekter. För att stärka arbetet med digitalisering och säkerställa att kommunen når sina mål krävs en kombination av kortsiktiga och långsiktiga åtgärder. Rapporten presenterar konkreta förslag som omfattar allt från kompetensutveckling och förbättrad samordning till införande av systematiska effektmätningar och integrering av digitalisering i all verksamhetsutveckling. Med rätt insatser kan Karlskoga kommun ytterligare stärka sin roll som en förebild inom digitalisering och samtidigt skapa bättre förutsättningar för medborgare, medarbetare och framtida generationer. Karlskoga kommun strävar efter att vara en ledande aktör inom digitalisering för att möta framtidens samhällsutmaningar. Med krav på att leverera 125 % välfärd med endast 75 % av dagens resurser är digitalisering en avgörande faktor för att uppnå effektivitet och hållbarhet. Fokus ligger på att förbättra kvalitet, tillgänglighet och kostnadseffektivitet genom att optimera processer, automatisera arbetsflöden och fatta datadrivna beslut. Rapporten granskar hur digitaliseringens möjligheter tas tillvara inom kommunens olika förvaltningar och identifierar områden för förbättringar. Uppdraget omfattar en kartläggning av digital mognad och kompetens inom kommunens olika förvaltningar. Metoden inkluderar självskattningar genom DiMiOS och DiKiOS, samt workshops och intervjuer med chefer och medarbetare för att samla in kvalitativa data. Internkontrolluppdraget för att utvärdera den digitala mognaden inom kommunens förvaltningar omfattar flera steg och metoder. För att kartlägga den digitala mognaden och kompetensen används självskattningsverktyg som DiMiOS och DiKiOS. Dessa verktyg ger en bild av nuläget och möjliggör jämförelser över tid för att se hur digital mognad och kompetens utvecklas. För att få en djupare förståelse genomförs workshops och intervjuer med chefer och medarbetare. Dessa aktiviteter syftar till att samla in kvalitativa data och skapa en gemensam förståelse för digitaliseringsstrategins betydelse och implementering. Vidare används en lärplattform för att kontinuerligt mäta och utveckla medarbetarnas digitala kompetens. Plattformen erbjuder utbildningar och säkerställer att material är lättillgängligt för att möjliggöra en effektiv digitalisering i verksamheten. Ledarskapet spelar en central roll i arbetet, och därför genomförs workshops med kommunledningsgruppen för att säkerställa förankring i verksamheten och enighet kring strategins nästa steg. Cheferna får tydliga förväntningar på att prioritera och uppmuntra digitalisering. Denna metodik syftar till att skapa en systematisk och strategisk grund för att öka den digitala mognaden och kompetensen inom kommunen, vilket är avgörande för att möta framtidens krav och säkerställa en effektiv användning av resurser. Internkontrollen fokuserar på digital mognad, hur digitaliseringsstrategin används, och hur förvaltningarna hanterar förbättringsförslag relaterade till digitalisering. Mätningar som DiMiOS och DiKiOS används för att bedöma nuläget och utvecklingen av digital mognad och kompetens. Intervjuer och workshops med förvaltningarna har genomförts för att samla in kvalitativ och kvantitativ data. Fokus har varit på självskattning och analyser av konkreta initiativ som implementerats. Internkontrollen har undersökt hur Karlskoga kommuns förvaltningar arbetar med digitalisering och implementeringen av kommunens digitaliseringsstrategi. Resultaten visar både framsteg och utmaningar, samt stora variationer mellan förvaltningarna när det gäller digital mognad, kompetens och strategisk prioritering. Analysen av Karlskoga kommuns digitaliseringsarbete visar på en blandad bild. Medan flera framgångsrika initiativ och projekt har genomförts, återstår utmaningar kring samordning, strategisk implementering och kompetensutveckling. Resultaten visar att digitalisering har prioriterats olika inom kommunen, vilket påverkar både mognaden och effekten av de insatser som gjorts. Resultaten visar att den digitala mognaden har ökat något, men det finns fortfarande stora variationer mellan förvaltningarna. Socialförvaltningen har uttryckt kritik mot centrala implementeringar, medan Samhälle och serviceförvaltningen har sett en ökad förståelse för digitalisering. Mätningar från DiMiOS under 2022 och 2023 indikerar att kommunens digitala mognad har ökat. Medarbetare har blivit mer medvetna om digitaliseringens betydelse, vilket reflekteras i minskade "vet ej"-svar i mätningarna. Den ökade mognaden är resultatet av flera samordnade insatser, såsom utbildningar och strukturella förändringar. Exempelvis har utbildningar som "Digitaliseringens ABC" och etableringen av forum som Digitaliseringsrådet stärkt både kompetensen och engagemanget. Samtidigt finns det en ojämn fördelning av den digitala mognaden i kommunen, med vissa verksamheter som upplevs ha kommit längre än andra. Denna variation är kopplad till faktorer som ledarskap, tillgång till resurser och förmågan att tillämpa strategin på ett systematiskt sätt. Kommunen har genomfört flera framgångsrika initiativ som bidragit till att förbättra effektiviteten och kvaliteten i verksamheterna: Tekniska lösningar: Digitala lås och läkemedelsrobotar har implementerats för att förbättra effektiviteten i vissa verksamheter. Digital infrastruktur: Arbetet med e-tjänster och nya system har gjort det enklare för både medarbetare och medborgare att använda kommunens tjänster. Utbildning och samverkan: Program som "Digitaliseringens ABC" har ökat kunskapen om digitalisering bland medarbetarna, och samarbeten genom KIS och Digitaliseringsrådet har skapat plattformar för idéutbyte och strategiska diskussioner. Trots framgångarna finns utmaningar som påverkar digitaliseringens genomslag i kommunen: Kompetens och förståelse Kompetensnivån varierar mellan medarbetare och verksamheter, vilket påverkar förmågan att använda digitala verktyg och implementera nya lösningar. Det finns även ett behov av att öka förståelsen för digitaliseringens strategiska betydelse. Samordning och strategisk tillämpning Medan vissa delar av organisationen har integrerat digitaliseringsstrategin i sin verksamhetsplanering, saknar andra en strukturerad och långsiktig strategi. Det finns en risk att arbetet med digitalisering sker fragmentariskt utan tydlig koppling till de övergripande målen. Effektmätning och uppföljning Uppföljning av digitaliseringsprojekt sker i varierande grad. I flera fall saknas systematisk mätning av nyttor och effekter, vilket försvårar möjligheten att dra lärdomar och vidareutveckla arbetet. Karlskoga kommun har tagit viktiga steg framåt inom digitalisering genom utbildning, tekniska lösningar och samarbetsinitiativ. De största utmaningarna handlar om att säkerställa en jämn fördelning av digital mognad och kompetens, att skapa strukturer för samordning och att förbättra uppföljningen av digitaliseringens effekter. För att ytterligare stärka arbetet bör kommunen fokusera på att: Systematiskt integrera digitalisering i alla verksamheters utvecklingsarbete. Stärka kompetensutvecklingen för att minska variationer i kunskap. Utveckla metoder för att mäta och följa upp digitaliseringens nyttor och effekter. Utifrån analysen av kommunens digitalisering framträder flera utmaningar och gap som behöver adresseras för att uppnå de långsiktiga målen. Varierande nivåer inom och mellan förvaltningar Den digitala kompetensen hos medarbetarna varierar stort både inom och mellan förvaltningarna. Exempel: Samhälle och serviceförvaltningen rapporterar att skillnader i datorkompetens påverkar genomförandet och nyttjandet av digitala lösningar. Åtgärder: Fokusera på systematiska utbildningar och skapa en lärplattform som stödjer individuella kompetensutvecklingsplaner. Digital otrygghet bland brukare och medarbetare Socialförvaltningen har uppmärksammat att otrygghet kring digitala tjänster finns både bland medarbetare och medborgare. Åtgärder: Kommunen kan förbättra arbetet med digital trygghet genom att erbjuda tydlig information och utbildning om digitaliseringens möjligheter och risker. Stort behov av samordning och ledarskap Ledarskapet kring digitalisering och samordning har inte varit tillräckligt starkt i alla förvaltningar. Åtgärder: Ge chefer och ledningsgrupper tydliga förväntningar på att prioritera digitalisering, och skapa samordningsstrukturer för att underlätta implementering. Utmaningar med uppföljning och effektmätning Det finns begränsad uppföljning av effekterna av digitalisering, vilket gör det svårt att bedöma framstegen och justera insatserna. Åtgärder: Etablera effektmätningar och uppföljning som en central del av arbetet, och säkerställ att lärdomar används för kontinuerlig förbättring. Analysen av kommunens digitalisering visar att det finns både framsteg och hinder, och att det krävs ytterligare insatser för att stärka den digitala mognaden, samordningen och uppföljningen.",
    "Här är en annan text som chatten kan använda för att generera svar."
]
index_texts(texts_to_index, collection)

# Sök funktion
def search_documents(query, collection):
    query_embedding = get_embedding(query, model="text-embedding-003")
    results = collection.query(
        query_embeddings=[query_embedding],
        n_results=5
    )
    return results['documents']

# Streamlit-app
st.title("AI Chat med dokument")

query = st.text_input("Ställ din fråga:")

if query:
    results = search_documents(query, collection)
    for result in results:
        st.write(f"**Resultat:** {result}")
